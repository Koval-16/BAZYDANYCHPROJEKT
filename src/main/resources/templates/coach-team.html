<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>ZarzƒÖdzanie Dru≈ºynƒÖ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light container mt-5">

<div class="d-flex justify-content-between align-items-center mb-4">
    <a th:href="@{/trener}" class="btn btn-outline-secondary">&larr; Wr√≥ƒá do panelu g≈Ç√≥wnego</a>

    <div class="d-flex align-items-center gap-3">
        <h2 class="fw-bold text-primary mb-0" th:text="${team.name}">Twoja Dru≈ºyna</h2>
        <a th:href="@{/dom/druzyny/{id}(id=${team.id})}" target="_blank" class="btn btn-sm btn-outline-primary" title="Zobacz jak inni widzƒÖ Tw√≥j zesp√≥≈Ç">
            üëÅÔ∏è PodglƒÖd
        </a>
    </div>
</div>

<div th:if="${successMessage}" class="alert alert-success alert-dismissible fade show">
    <span th:text="${successMessage}"></span>
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
</div>
<div th:if="${errorMessage}" class="alert alert-danger alert-dismissible fade show">
    <span th:text="${errorMessage}"></span>
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
</div>

<div class="row">
    <div class="col-lg-8">
        <div class="card shadow mb-4">
            <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                <h5 class="mb-0">üìã Aktualny Sk≈Çad</h5>
                <span class="badge bg-light text-dark" th:text="${squad.size()} + ' zawodnik√≥w'">0</span>
            </div>
            <div class="card-body p-0">
                <table class="table table-striped table-hover mb-0 align-middle">
                    <thead class="table-light">
                    <tr>
                        <th>#</th>
                        <th>Zawodnik</th>
                        <th>Narodowo≈õƒá</th>
                        <th>Status</th>
                        <th class="text-end">Akcja</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="member, iter : ${squad}">
                        <td th:text="${iter.count}">1</td>
                        <td class="fw-bold" th:text="${member.user.name} + ' ' + ${member.user.surname}"></td>
                        <td th:text="${member.user.nationality}"></td>
                        <td>
                            <span th:if="${member.contract.confirmed}" class="badge bg-success">‚úÖ W sk≈Çadzie</span>
                            <span th:unless="${member.contract.confirmed}" class="badge bg-warning text-dark">‚è≥ Oczekuje</span>
                        </td>
                        <td class="text-end">
                            <form th:action="@{/trener/usun-pilkarza}" method="post" onsubmit="return confirm('Potwierdzasz usuniƒôcie zawodnika?');">
                                <input type="hidden" name="contractId" th:value="${member.contract.id}"/>
                                <button type="submit" class="btn btn-sm btn-outline-danger">
                                    <span th:if="${member.contract.confirmed}">‚ùå Usu≈Ñ</span>
                                    <span th:unless="${member.contract.confirmed}">üö´ Anuluj</span>
                                </button>
                            </form>
                        </td>
                    </tr>
                    <tr th:if="${#lists.isEmpty(squad)}">
                        <td colspan="5" class="text-center py-5 text-muted">Pusto w szatni...</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="col-lg-4">
        <div class="card shadow mb-4 border-info">
            <div class="card-header bg-info text-white d-flex justify-content-between align-items-center">
                <h5 class="mb-0">‚ÑπÔ∏è Informacje o Klubie</h5>
                <button class="btn btn-sm btn-light text-info fw-bold" data-bs-toggle="modal" data-bs-target="#editTeamModal">
                    ‚úèÔ∏è Edytuj
                </button>
            </div>
            <div class="card-body">
                <p class="mb-1"><strong>Stadion:</strong> <span th:text="${team.stadium}"></span></p>
                <p class="mb-1"><strong>Adres:</strong> <span th:text="${team.address}"></span></p>
                <hr>
                <p class="mb-1"><strong>Stroje domowe:</strong> <span th:text="${team.kitsHome}"></span></p>
                <p class="mb-0"><strong>Stroje wyjazdowe:</strong> <span th:text="${team.kitsAway}"></span></p>
            </div>
        </div>

        <div class="card shadow border-success mb-4">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">‚ûï Transfery</h5>
            </div>
            <div class="card-body">
                <form th:action="@{/trener/dodaj-pilkarza}" method="post">
                    <input type="hidden" name="teamId" th:value="${teamInLeagueId}"/>
                    <div class="mb-3">
                        <label class="form-label fw-bold">Wolni zawodnicy:</label>
                        <select name="playerId" class="form-select" required>
                            <option value="" disabled selected>-- Wybierz --</option>
                            <option th:each="player : ${freePlayers}"
                                    th:value="${player.id}"
                                    th:text="${player.name} + ' ' + ${player.surname}"></option>
                        </select>
                    </div>
                    <div class="d-grid">
                        <button type="submit" class="btn btn-success">üì© Wy≈õlij ofertƒô</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <div class="card shadow mb-5">
            <div class="card-header bg-dark text-white">
                <h5 class="mb-0">üìÖ Terminarz i Negocjacje</h5>
            </div>
            <div class="card-body p-0">
                <table class="table table-hover align-middle mb-0">
                    <thead class="table-light">
                    <tr>
                        <th style="width: 35%;">Mecz</th>
                        <th style="width: 30%;">Data / Status</th>
                        <th class="text-end">Akcja</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="match : ${matches}">
                        <td>
                            <div class="d-flex align-items-center">
                                <span th:class="${match.hostId == teamId} ? 'fw-bold text-primary' : 'text-dark'"
                                      th:text="${match.hostName}">Gospodarz</span>
                                <span class="badge bg-light text-secondary border mx-2">vs</span>
                                <span th:class="${match.awayId == teamId} ? 'fw-bold text-primary' : 'text-dark'"
                                      th:text="${match.awayName}">Go≈õƒá</span>
                            </div>
                            <div th:if="${match.isPlayed}" class="mt-1">
                                <span class="badge bg-dark">
                                    Wynik: <span th:text="${match.hostResult} + ' : ' + ${match.awayResult}"></span>
                                </span>
                            </div>
                        </td>

                        <td>
                            <div th:if="${match.proposalStatus == 0 or match.proposalStatus == 3}">
                                <div class="fs-6 fw-bold text-dark" th:text="${match.date}"></div>
                                <span th:if="${match.proposalStatus == 3}" class="badge bg-success">‚úÖ Data ustalona</span>
                                <span th:if="${match.proposalStatus == 0}" class="badge bg-secondary">Brak propozycji zmian</span>
                            </div>

                            <div th:if="${match.proposalStatus == 1 or match.proposalStatus == 2}">
                                <div class="fs-6 fw-bold text-warning text-dark" th:text="${match.proposedDate}"></div>

                                <span th:if="${match.proposalStatus == 1}" class="badge bg-warning text-dark">üìÖ Propozycja w toku</span>
                                <span th:if="${match.proposalStatus == 2}" class="badge bg-info text-dark">‚è≥ Czeka na Admina</span>
                            </div>
                        </td>

                        <td class="text-end">
                            <div th:if="${!match.isPlayed}">

                                <div th:if="${match.hostId == teamId}">
                                    <div th:if="${match.proposalStatus <= 1}">
                                        <form th:action="@{/trener/mecze/proponuj}" method="post" class="d-flex justify-content-end align-items-center gap-2">
                                            <input type="hidden" name="matchId" th:value="${match.id}"/>
                                            <div class="input-group input-group-sm" style="width: 170px;">
                                                <input type="date" name="date" class="form-control" required th:value="${match.proposedDate}">
                                                <button type="submit" class="btn btn-outline-primary" title="Zaproponuj zmianƒô">üì©</button>
                                            </div>
                                        </form>
                                    </div>
                                    <div th:if="${match.proposalStatus == 2}">
                                        <small class="text-muted fst-italic">Czekamy na administratora...</small>
                                    </div>
                                </div>

                                <div th:if="${match.awayId == teamId}">
                                    <div th:if="${match.proposalStatus == 1}">
                                        <span class="d-block small text-muted mb-1">Rywal proponuje zmianƒô:</span>
                                        <div class="btn-group btn-group-sm">
                                            <form th:action="@{/trener/mecze/odpowiedz}" method="post">
                                                <input type="hidden" name="matchId" th:value="${match.id}"/>
                                                <input type="hidden" name="accepted" value="true"/>
                                                <button type="submit" class="btn btn-success">Zgoda</button>
                                            </form>
                                            <form th:action="@{/trener/mecze/odpowiedz}" method="post" class="ms-1">
                                                <input type="hidden" name="matchId" th:value="${match.id}"/>
                                                <input type="hidden" name="accepted" value="false"/>
                                                <button type="submit" class="btn btn-danger">Odrzuƒá</button>
                                            </form>
                                        </div>
                                    </div>
                                    <div th:if="${match.proposalStatus == 0}">
                                        <small class="text-muted">Czekaj na propozycjƒô gospodarza.</small>
                                    </div>
                                    <div th:if="${match.proposalStatus == 2}">
                                        <small class="text-success fw-bold">Zgodzi≈Çe≈õ siƒô.</small> <small class="text-muted">Czekamy na admina.</small>
                                    </div>
                                </div>

                            </div>

                            <div th:if="${match.isPlayed}">
                                <span class="badge bg-secondary">Zako≈Ñczony</span>
                            </div>
                        </td>
                    </tr>
                    <tr th:if="${#lists.isEmpty(matches)}">
                        <td colspan="3" class="text-center py-4 text-muted">Brak mecz√≥w w terminarzu.</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="editTeamModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-info text-white">
                <h5 class="modal-title">Edytuj dane dru≈ºyny</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form th:action="@{/trener/edytuj-druzyne}" method="post">
                    <input type="hidden" name="teamId" th:value="${team.id}"/>
                    <div class="mb-3">
                        <label class="form-label">Nazwa Klubu</label>
                        <input type="text" class="form-control" name="name" th:value="${team.name}" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Skr√≥t (3-4 znaki)</label>
                        <input type="text" class="form-control" name="abbreviation" th:value="${team.abbreviation}" required maxlength="4">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Stadion</label>
                        <input type="text" class="form-control" name="stadium" th:value="${team.stadium}" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Adres</label>
                        <input type="text" class="form-control" name="address" th:value="${team.address}" required>
                    </div>
                    <div class="row">
                        <div class="col-6 mb-3">
                            <label class="form-label">Stroje Domowe</label>
                            <input type="text" class="form-control" name="kitsHome" th:value="${team.kitsHome}" required>
                        </div>
                        <div class="col-6 mb-3">
                            <label class="form-label">Stroje Wyjazd.</label>
                            <input type="text" class="form-control" name="kitsAway" th:value="${team.kitsAway}" required>
                        </div>
                    </div>
                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-info text-white fw-bold">Zapisz zmiany</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>